<% content_for :title, "Cart" %>
<% content_for :native_signals, native_form_tag %>

<div class="mt-4">
  <h1 class="text-2xl font-bold text-coffee-800 dark:text-coffee-100 <%= "hidden" if native_app? %>">
    Your order
  </h1>

  <% if @cart_items.any? %>
    <div class="mt-4 space-y-3">
      <% @cart_items.each do |item| %>
        <div class="p-4 rounded-2xl bg-white dark:bg-coffee-900 shadow-sm">
          <div class="flex items-start justify-between">
            <div class="flex-1 min-w-0">
              <h3 class="font-semibold text-coffee-800 dark:text-coffee-100"><%= item.product.name %></h3>
              <p class="text-sm text-coffee-500 dark:text-coffee-400 mt-0.5"><%= item.customization_summary %></p>
            </div>
            <p class="font-semibold text-coffee-800 dark:text-coffee-100 ml-4"><%= item.display_line_total %></p>
          </div>

          <div class="flex items-center justify-between mt-3">
            <div class="flex items-center gap-2">
              <% if item.quantity > 1 %>
                <%= form_with url: cart_cart_item_path(item), method: :patch, class: "inline" do |f| %>
                  <%= f.hidden_field :quantity, value: item.quantity - 1 %>
                  <%= f.submit "−", class: "w-8 h-8 rounded-full bg-coffee-100 dark:bg-coffee-800 text-coffee-700 dark:text-coffee-300 font-bold text-sm cursor-pointer" %>
                <% end %>
              <% else %>
                <div class="w-8 h-8 rounded-full bg-coffee-100/50 dark:bg-coffee-800/50 text-coffee-400 dark:text-coffee-600 flex items-center justify-center font-bold text-sm">−</div>
              <% end %>

              <span class="w-6 text-center font-medium text-coffee-800 dark:text-coffee-100"><%= item.quantity %></span>

              <%= form_with url: cart_cart_item_path(item), method: :patch, class: "inline" do |f| %>
                <%= f.hidden_field :quantity, value: item.quantity + 1 %>
                <%= f.submit "+", class: "w-8 h-8 rounded-full bg-coffee-100 dark:bg-coffee-800 text-coffee-700 dark:text-coffee-300 font-bold text-sm cursor-pointer" %>
              <% end %>
            </div>

            <%= button_to "Remove", cart_cart_item_path(item), method: :delete, class: "text-sm text-red-600 dark:text-red-400 font-medium cursor-pointer" %>
          </div>
        </div>
      <% end %>
    </div>

    <div class="mt-6 p-4 rounded-2xl bg-white dark:bg-coffee-900 shadow-sm">
      <div class="flex items-center justify-between">
        <span class="font-semibold text-coffee-800 dark:text-coffee-100">Total</span>
        <span class="text-lg font-bold text-coffee-800 dark:text-coffee-100"><%= @cart.display_total %></span>
      </div>
    </div>

    <div class="mt-4">
      <%= button_to "Place order", orders_path, class: "w-full rounded-xl bg-coffee-800 dark:bg-coffee-200 text-white dark:text-coffee-900 font-semibold py-3 hover:bg-coffee-700 dark:hover:bg-coffee-300 transition cursor-pointer" %>
    </div>
  <% else %>
    <div class="mt-12 text-center">
      <div class="w-16 h-16 mx-auto rounded-full bg-coffee-100 dark:bg-coffee-800 flex items-center justify-center">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8 text-coffee-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 10.5V6a3.75 3.75 0 10-7.5 0v4.5m11.356-1.993l1.263 12c.07.665-.45 1.243-1.119 1.243H4.25a1.125 1.125 0 01-1.12-1.243l1.264-12A1.125 1.125 0 015.513 7.5h12.974c.576 0 1.059.435 1.119 1.007zM8.625 10.5a.375.375 0 11-.75 0 .375.375 0 01.75 0zm7.5 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z" />
        </svg>
      </div>
      <h2 class="mt-4 font-semibold text-coffee-800 dark:text-coffee-100">Your cart is empty</h2>
      <p class="mt-1 text-sm text-coffee-500 dark:text-coffee-400">Browse the menu and add some items.</p>
      <%= link_to "Browse menu", categories_path, class: "inline-block mt-4 rounded-xl bg-coffee-800 dark:bg-coffee-200 text-white dark:text-coffee-900 font-semibold py-2 px-6 hover:bg-coffee-700 dark:hover:bg-coffee-300 transition" %>
    </div>
  <% end %>
</div>
